<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Ortografía: Elige la Frase Correcta</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%); /* Degradado suave */
            background-size: 200% 200%;
            animation: gradientAnimation 10s ease infinite alternate;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            /* Mejoras para la nitidez de la fuente */
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); /* Sombra más profunda */
            text-align: center;
            max-width: 800px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            opacity: 0; /* Para animación de entrada */
            transform: translateY(20px); /* Para animación de entrada */
            animation: fadeInSlideUp 0.8s ease-out forwards;
            position: relative; /* Necesario para el botón de inicio */
        }

        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sección de encabezado para alineación */
        .header-section {
            display: flex;
            align-items: center; /* Centrar verticalmente los elementos */
            justify-content: flex-start; /* Alinear elementos al inicio (izquierda) */
            width: 100%; /* Ocupar todo el ancho del contenedor */
            margin-bottom: 1rem; /* Espacio debajo del encabezado */
        }

        h1 {
            color: #2c3e50; /* Color de título más oscuro */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
            margin: 0; /* Reiniciar márgenes predeterminados de h1 dentro de flex */
            font-size: 2.5rem; /* Tamaño predeterminado para pantallas grandes */
            flex-grow: 1; /* Permitir que h1 crezca y ocupe el espacio disponible */
            text-align: center; /* Centrar el texto dentro del espacio de h1 */
            margin-left: 2rem; /* Añadir margen izquierdo para alejar el texto del icono */
        }

        .option-button {
            background: linear-gradient(145deg, #e2f0ff, #cce0ff); /* Degradado en botones */
            color: #1a202c;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600; /* Fuente más negrita para opciones */
            cursor: pointer;
            transition: all 0.2s ease-in-out; /* Transición más general */
            border: 2px solid transparent;
            text-align: left;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .option-button:hover:not(.selected):not(.correct):not(.incorrect):not(:disabled) {
            background: linear-gradient(145deg, #cce0ff, #b3d4ff);
            transform: translateY(-3px) scale(1.01); /* Resalte más pronunciado */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        .option-button.selected {
            background: linear-gradient(145deg, #93c5fd, #60a5fa); /* Degradado azul */
            border-color: #3b82f6; /* Blue-500 */
            color: #1e40af; /* Blue-800 */
            box-shadow: 0 3px 8px rgba(59, 130, 246, 0.4);
        }
        .option-button.correct {
            background: linear-gradient(145deg, #81c784, #4CAF50); /* Degradado verde vibrante */
            border-color: #4CAF50; /* Verde más oscuro */
            color: #000000; /* Texto en negro para la opción correcta */
            box-shadow: 0 3px 8px rgba(76, 175, 80, 0.4);
            animation: pulseCorrect 0.5s ease-out; /* Animación de feedback */
        }
        .option-button.incorrect {
            background: linear-gradient(145deg, #fee2e2, #fca5a5); /* Degradado rojo */
            border-color: #ef4444; /* Red-500 */
            color: #991b1b; /* Red-800 */
            box-shadow: 0 3px 8px rgba(239, 68, 68, 0.4);
            animation: shakeIncorrect 0.5s ease-out; /* Animación de feedback */
        }
        .option-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }

        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        @keyframes shakeIncorrect {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .navigation-button {
            background: linear-gradient(145deg, #3b82f6, #2563eb); /* Degradado azul */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 3px 8px rgba(59, 130, 246, 0.3);
        }
        .navigation-button:hover {
            background: linear-gradient(145deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(59, 130, 246, 0.4);
        }
        .navigation-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
            transform: translateY(0);
        }

        /* Estilos para la puntuación y la barra de progreso */
        .score-display-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
        }
        .score-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .score-item i {
            font-size: 1.2rem;
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e0e7eb;
            border-radius: 0.5rem;
            height: 12px;
            overflow: hidden;
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #63b3ed, #3b82f6); /* Degradado azul */
            border-radius: 0.5rem;
            transition: width 0.5s ease-in-out;
        }
        .feedback-icon {
            margin-left: 0.5rem;
            font-size: 1.8rem; /* Tamaño del icono de feedback */
            vertical-align: middle;
        }
        .feedback-icon.correct-icon {
            color: #4CAF50; /* Verde vibrante */
        }
        .feedback-icon.incorrect-icon {
            color: #ef4444; /* Rojo */
        }
        /* Estilo ajustado del contador de preguntas */
        #question-counter {
            color: #334155; /* Color más oscuro para visibilidad */
            font-size: 1rem; /* Tamaño de fuente ligeramente más grande */
            font-weight: 500;
            margin-bottom: 1rem; /* Asegurar que tenga espacio */
        }

        /* Estilos para mensajes/confirmaciones en la página */
        .in-page-info-message {
            font-size: 1.1rem;
            color: #2c3e50;
            margin-top: 1rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        .in-page-action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        .in-page-action-buttons .navigation-button {
            flex-grow: 1;
            max-width: 250px;
        }

        /* Visualización combinada de puntuación y resultados generales */
        .combined-results-display {
            display: flex;
            flex-wrap: wrap; /* Permitir el ajuste en pantallas más pequeñas */
            justify-content: center; /* Centrar elementos */
            align-items: center;
            gap: 1.5rem; /* Espacio entre elementos */
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            padding: 0.5rem 1rem;
            background-color: #f8fafc; /* Fondo claro para la barra */
            border-radius: 0.75rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .combined-results-display .score-item {
            margin: 0; /* Eliminar margen predeterminado de score-item */
        }

        .overall-summary-inline {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1rem; /* Ligeramente más pequeño para la línea */
            color: #334155;
            flex-wrap: wrap; /* Permitir el ajuste también para los totales */
            justify-content: center;
        }
        .overall-summary-inline span {
            font-weight: 700;
        }
        .overall-summary-inline .text-green-700 {
            color: #16a34a;
        }
        .overall-summary-inline .text-red-700 {
            color: #dc2626;
        }

        /* Estilos específicos del botón de inicio */
        .home-button-icon {
            font-size: 1.8rem; /* Tamaño del icono */
            color: #3b82f6; /* Color azul */
            transition: color 0.2s ease-in-out;
            z-index: 10; /* Asegurar que esté por encima de otro contenido */
            margin-right: 1rem; /* Espacio entre el icono y el título */
            flex-shrink: 0; /* Evitar que el icono se encoja */
        }
        .home-button-icon:hover {
            color: #2563eb; /* Azul más oscuro al pasar el ratón */
        }

        /* Estilo para el icono de reinicio más discreto */
        .restart-icon {
            font-size: 1.5rem; /* Tamaño del icono */
            color: #94a3b8; /* Color gris sutil (slate-400) */
            cursor: pointer;
            transition: color 0.2s ease-in-out, transform 0.2s ease-in-out;
            margin-left: 1rem; /* Espacio de otros elementos en la barra */
        }

        .restart-icon:hover:not(.disabled) {
            color: #3b82f6; /* Azul al pasar el ratón */
            transform: rotate(30deg); /* Rotación sutil al pasar el ratón */
        }

        .restart-icon.disabled {
            color: #cbd5e1; /* Gris más claro cuando está deshabilitado (slate-300) */
            cursor: not-allowed;
        }

        /* Media query para pantallas más pequeñas: ajustar posición del botón de inicio y tamaño del título */
        @media (max-width: 639px) {
            .home-button-icon {
                font-size: 1.5rem;
                margin-right: 0.5rem; /* Ajustar margen para pantallas más pequeñas */
            }
            .container {
                padding: 1.5rem; /* Reducir el padding en pantallas pequeñas */
            }
            .header-section {
                margin-bottom: 0.5rem; /* Menos espacio en pantallas pequeñas */
            }
            /* El tamaño de fuente de h1 se ajusta arriba para móvil */
            .combined-results-display {
                gap: 0.75rem; /* Reducir el espacio en pantallas más pequeñas */
                padding: 0.4rem 0.8rem;
            }
            .overall-summary-inline {
                font-size: 0.9rem; /* Fuente más pequeña para los totales en móvil */
                gap: 0.5rem;
            }
            .restart-icon {
                font-size: 1.2rem; /* Icono más pequeño en móvil */
                margin-left: 0.5rem; /* Menos margen en móvil */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sección de Encabezado para el Botón de Inicio y el Título -->
        <div class="header-section">
            <a href="index.html" class="home-button-icon" title="Volver al listado de tests">
                <i class="fas fa-home"></i>
            </a>
            <h1 class="text-3xl md:text-4xl font-extrabold leading-tight">
                Test de Ortografía: Elige la Frase Correcta
            </h1>
        </div>
        
        <p class="text-md text-gray-600 mb-6">
            Pon a prueba tus conocimientos sobre las reglas ortográficas del español.
        </p>

        <!-- Área del Test -->
        <div id="test-area">
            <p id="question-counter" class="text-sm text-gray-500 mb-4"></p>

            <p id="current-question" class="text-2xl font-semibold text-gray-900 mb-6"></p>

            <div id="options-container" class="grid grid-cols-1 gap-4 mb-6">
                <!-- Las opciones se cargarán aquí con JavaScript -->
            </div>

            <div class="flex justify-between gap-4">
                <button id="prev-button" class="navigation-button">Anterior</button>
                <button id="next-button" class="navigation-button">Siguiente</button>
            </div>

            <!-- Visualización Combinada de Puntuación y Resultados Generales -->
            <div class="combined-results-display">
                <div class="score-item text-green-600">
                    <i class="fas fa-check-circle"></i>
                    <span id="correct-count">0</span>
                </div>
                <div class="score-item text-red-600">
                    <i class="fas fa-times-circle"></i>
                    <span id="incorrect-count">0</span>
                </div>
                <div id="overall-summary-inline" class="overall-summary-inline hidden">
                    <span>Total:</span>
                    <span class="text-green-700">Aciertos: <span id="overall-correct-display">0</span></span>
                    <span class="text-red-700">Errores: <span id="overall-incorrect-display">0</span></span>
                </div>
                <!-- Botón de Reiniciar Test Completo como icono -->
                <i id="restart-button" class="fas fa-sync-alt restart-icon disabled" title="Reiniciar test completo"></i>
            </div>

            <div class="progress-bar-container">
                <div id="progress-bar-fill" class="progress-bar-fill"></div>
            </div>

            <!-- Área para mensajes y botones dinámicos -->
            <div id="dynamic-message-area">
                <p id="dynamic-info-message" class="in-page-info-message"></p>
                <div id="dynamic-action-buttons" class="in-page-action-buttons"></div>
            </div>

            <div id="feedback-message" class="text-lg font-bold mt-4 mb-2 flex items-center justify-center" style="min-height: 1.5em;">
                <!-- El texto y el icono de feedback aparecerán aquí -->
            </div>
            <div id="explanation-message" class="text-md explanation-message mt-2 mb-4"></div>
        </div>
    </div>

    <script>
        (function() { // IIFE comienza aquí para crear un nuevo ámbito
            // Contenido de las preguntas extraído del documento DOCX
            const docContent = `
Pregunta 1: ¿Cuál de estas oraciones es correcta? a) Se ha cansado de esperar, ah decidido irse. b) Se ha cansado de esperar, ha decidido irse. (R) c) Se a cansado de esperar, a decidido irse. d) Se a cansado de esperar, ha decidido hirce. Explicación: 'Ha' es la forma del verbo 'haber' para los tiempos compuestos.
Pregunta 2: Elige la frase correctamente escrita. a) No sé porqué no me llamó anoche. b) No sé por que no me llamó anoche. c) No sé por qué no me llamó anoche. (R) d) No sé porque no me llamó anoche. Explicación: 'Por qué' se usa en preguntas indirectas.
Pregunta 3: Identifica la oración sin errores. a) Haber si puedes venir a la fiesta, va a a ver mucha gente. b) A ver si puedes venir a la fiesta, va a haber mucha gente. (R) c) Haber si puedes venir a la fiesta, va a ver mucha jente. d) A ver si puedes venir a la fiesta, va a a ver mucha jente. Explicación: 'A ver' es la expresión de expectativa; 'haber' es el verbo impersonal.
Pregunta 4: ¿Qué frase está escrita correctamente? a) No es mi intención dañarle, si no ayudarle. b) No es mi intención dañarle, sinó ayudarle. c) No es mi intención dañarle, sino ayudarle. (R) d) No es mi intencion dañarle, sino ayudarle. Explicación: 'Sino' es una conjunción adversativa que opone ideas. 'Dañarle' es correcto con 'le'.
Pregunta 5: Selecciona la opción correcta. a) Deberías echar la basura hecha a un lado. b) Deberías hechar la basura hecha a un lado. c) Deberías echar la basura echa a un lado. (R) d) Deberías hechar la basura echa a un lado. Explicación: 'Echar' (sin 'h') es el verbo de arrojar; 'echa' es su conjugación.
Pregunta 6: ¿Cuál de las siguientes oraciones es correcta? a) El tubo que tubo que instalar era de metal. b) El tubo que tuvo que instalar era de metal. (R) c) El tuvo que tubo que instalar era de metal. d) El tubo que tubo que instalar era de metál. Explicación: 'Tubo' es el conducto; 'tuvo' es la forma del verbo 'tener'.
Pregunta 7: Escoge la frase sin errores ortográficos. a) La valla publicitaria era enorme, ¡baya suerte que no nos vaya mal! b) La baya publicitaria era enorme, ¡valla suerte que no nos vaya mal! c) La valla publicitaria era enorme, ¡vaya suerte que no nos vaya mal! (R) d) La vaya publicitaria era enorme, ¡valla suerte que no nos baya mal! Explicación: 'Valla' (cerco); 'vaya' (del verbo ir o interjección); 'baya' (fruto).
Pregunta 8: ¿Cuál oración es correcta? a) ¡Hala, qué frío hace aquí. (R) b) ¡Ala, qué frío hace aquí. c) ¡Ah la, qué frío hace aquí. d) ¡Ha la, qué frío hace aquí. Explicación: 'Hala' es una interjección para expresar sorpresa o prisa.
Pregunta 9: Identifica la opción correctamente escrita. a) Él no viene porque no quiere, mas si no cambia de opinión, lo perderá todo. (R) b) Él no viene porque no quiere, mas sino cambia de opinión, lo perderá todo. c) Él no viene porque no quiere, más si no cambia de opinión, lo perderá todo. d) Él no viene porque no quiere, más sino cambia de opinión, lo perdera todo. Explicación: 'Mas' (sin tilde) es una conjunción adversativa (equivalente a 'pero'); 'si no' es la condicional.
Pregunta 10: ¿Qué frase utiliza correctamente 'hay', 'ahí' y 'ay'? a) ¡Ay! Hay un gato ahí en el tejado. (R) b) ¡Ahí! Hay un gato ay en el tejado. c) ¡Hay! Ay un gato ahí en el tejado. d) ¡Ay! Ahí un gato hay en el tejado. Explicación: 'Ay' (interjección); 'hay' (del verbo haber); 'ahí' (adverbio de lugar).
Pregunta 11: ¿Qué frase es correcta? a) No es por dinero, si no por principios. b) No es por dinero, sino por principios. (R) c) No es por dinero, si no por prinsipio. d) No es por dinero, sí no por principios. Explicación: 'Sino' (junto) es una conjunción adversativa que opone ideas.
Pregunta 12: Elige la oración bien escrita. a) Se a visto con sus propios ojos. b) Se ha visto con sus propios ojos. (R) c) Se ah visto con sus propios ojos. d) Se ha bisto con sus propios ojos. Explicación: 'Ha' es la forma del verbo 'haber' como auxiliar.
Pregunta 13: ¿Cuál opción es correcta? a) La razón porque te lo digo es importante. b) La razón por qué te lo digo es importante. c) La razón por la que te lo digo es importante. (R) d) La razón porqué te lo digo es importante. Explicación: 'Por la que' es la forma adecuada cuando 'que' es un pronombre relativo.
Pregunta 14: Selecciona la frase correcta. a) Haya paz en el mundo. (R) b) Aya paz en el mundo. c) Halla paz en el mundo. d) Allá paz en el mundo. Explicación: 'Haya' es la forma del verbo 'haber' en subjuntivo (que exista).
Pregunta 15: ¿Cuál oración es correcta? a) El aya del niño lo cuida con esmero. (R) b) El halla del niño lo cuida con esmero. c) El haya del niño lo cuida con esmero. d) El allá del niño lo cuida con esmero. Explicación: 'Aya' (con 'y') se refiere a la niñera o cuidadora.
Pregunta 16: Elige la opción correcta. a) Este es un tema á abordar con urgencia. b) Este es un tema a abordar con urgencia. (R) c) Este es un tema ha abordar con urgencia. d) Este es un tema ah abordar con urgencia. Explicación: 'A' es una preposición que introduce el complemento directo o indirecto.
Pregunta 17: ¿Qué frase está correctamente acentuada? a) Él solo quería un libro. (R) b) Él sólo quería un libro. c) El sólo quería un libro. d) El solo queria un libro. Explicación: Según la RAE, 'solo' (adverbio) no lleva tilde. 'Él' (pronombre) sí. 'Quería' lleva tilde por ser hiato.
Pregunta 18: Selecciona la oración correcta. a) El bello paisaje me dejó sin aliento. (R) b) El vello paisaje me dejó sin aliento. c) El bello paisage me dejó sin aliento. d) El vello paisage me dejó sin aliento. Explicación: 'Bello' (con 'b') significa hermoso. 'Paisaje' se escribe con 'j'.
Pregunta 19: ¿Cuál de estas oraciones es correcta? a) Te hecho de menos cada día. b) Te echo de menos cada día. (R) c) Te he hecho de menos cada día. d) Te echo de menos cada dia. Explicación: 'Echo' (sin 'h') es del verbo 'echar' (echar de menos). 'Hecho' (con 'h') es el participio del verbo 'hacer'.
Pregunta 20: Elige la frase correctamente escrita. a) No sé si mañana podré ir. (R) b) No sé sí mañana podré ir. c) No se si mañana podré ir. d) No sé sí mañana podre ir. Explicación: 'Si' (sin tilde) es una conjunción condicional o interrogativa. 'Podré' lleva tilde.
Pregunta 21: Identifica la oración sin errores. a) ¡Ay! Qué frío hace ahí afuera, no hay nadie en la calle. (R) b) ¡Ahí! Qué frío hace ay afuera, no hay nadie en la calle. c) ¡Hay! Qué frío hace ahí afuera, no ay nadie en la calle. d) ¡Ay! Qué frío hace hay afuera, no ahí nadie en la calle. Explicación: 'Ay' (interjección); 'ahí' (adverbio de lugar); 'hay' (verbo haber).
Pregunta 22: ¿Qué frase está escrita correctamente? a) El porqué de su comportamiento es un misterio. (R) b) El por que de su comportamiento es un misterio. c) El porque de su comportamiento es un misterio. d) El por qué de su comportamiento es un misterio. Explicación: 'Porqué' (con tilde y junto) es un sustantivo.
Pregunta 23: Selecciona la opción correcta. a) ¿Por qué no contestas el teléfono? (R) b) ¿Por que no contestas el teléfono? c) ¿Porque no contestas el teléfono? d) ¿Porqué no contestas el telefono? Explicación: 'Por qué' se usa para preguntas directas. 'Porqué' (junto y con tilde) es un sustantivo.
Pregunta 24: ¿Cuál de las siguientes oraciones es correcta? a) El niño tuvo un tubo en la mano. (R) b) El niño tubo un tuvo en la mano. c) El niño tubo un tubo en la manó. d) El niño tuvo un tubo en la mano. Explicación: 'Tuvo' (verbo tener); 'tubo' (sustantivo, conducto).
Pregunta 25: Elige la frase correctamente escrita. a) Él siempre ha estado ahí para mí. (R) b) Él siempre a estado hay para mí. c) Él siempre ah estado ay para mí. d) Él siempre ha estado hay para mi. Explicación: 'Ha' (verbo haber); 'ahí' (adverbio de lugar). 'Mí' con tilde al ser pronombre personal.
Pregunta 26: Identifica la oración sin errores. a) No es blanco, si no negro. b) No es blanco, sino negro. (R) c) No es blanco, sí no negro. d) No es blanco, sinó negro. Explicación: 'Sino' (junto) para contraponer.
Pregunta 27: ¿Qué frase está escrita correctamente? a) La información que me diste a sido de gran ayuda. b) La información que me diste ha sido de gran ayuda. (R) c) La información que me diste ah sido de gran ayuda. d) La información qué me diste ha sido de gran alluda. Explicación: 'Ha' (verbo haber); 'que' (sin tilde si no es interrogativo). 'Ayuda' con 'y'.
Pregunta 28: Selecciona la opción correcta. a) Halla la solución al problema. (R) b) Haya la solución al problema. c) Allá la solución al problema. d) Halla la solusión al problema. Explicación: 'Halla' (del verbo 'hallar', encontrar).
Pregunta 29: ¿Cuál de las siguientes oraciones es correcta? a) No te eches para atrás ahora. (R) b) No te heches para atrás ahora. c) No te eches para atrás aora. d) No te heches para atras ahora. Explicación: 'Eches' (del verbo 'echar', sin 'h'). 'Atrás' lleva tilde.
Pregunta 30: Elige la frase correctamente escrita. a) Hay que ir a votar. (R) b) Ay que ir a votar. c) Ahí que ir a votar. d) Hay que hir a votar. Explicación: 'Hay que' indica obligación impersonal. 'Ir' es sin 'h'.
Pregunta 31: ¿Cuál de estas frases es correcta? a) Su vello facial era abundante. b) Su bello facial era abundante. c) El vello vestido era precioso. d) El bello vestido era presioso. (R) Explicación: 'Bello' significa hermoso o bonito. 'Vello' se refiere al pelo corto y suave del cuerpo.
Pregunta 32: ¿Qué frase está escrita correctamente? a) Se lo di para que lo hiciera porqué sí. b) Se lo di para que lo hiciera por qué sí. c) Se lo di para que lo hiciera porque sí. (R) d) Se lo di para qué lo hiciera porqué sí. Explicación: 'Porque sí' es una expresión que significa "sin razón aparente".
Pregunta 33: Selecciona la opción correcta. a) No ha habido tiempo para todo. (R) b) No a habido tiempo para todo. c) No ah habido tiempo para todo. d) No ha habido tienpo para todó. Explicación: 'Ha habido' es la forma correcta del pretérito perfecto compuesto del verbo 'haber'. 'Tiempo' con 'm' antes de 'p'.
Pregunta 34: ¿Cuál de las siguientes oraciones es correcta? a) Sino me ayudas, no podré terminar. b) Si no me ayudas, no podré terminar. (R) c) No me ayudas sino terminar. d) No me ayudas, si no terminar. Explicación: 'Si no' (separado) introduce una condición negativa.
Pregunta 35: Elige la frase correctamente escrita. a) Los ayes de dolor eran desgarradores. (R) b) Los ahíes de dolor eran desgarradores. c) Los hayes de dolor eran desgarradores. d) Los ayes de dolor eran desgaradores. Explicación: 'Ayes' es el sustantivo plural de la interjección 'ay', que se refiere a lamentos o quejidos. 'Desgarradores' con doble 'r'.
Pregunta 36: Identifica la oración sin errores. a) Se fue de hay sin decir nada. b) Se fue de ahí sin decir nada. (R) c) Se fue de ay sin decir nada. d) Se fue de ahí sin decir nadá. Explicación: 'Ahí' es un adverbio de lugar.
Pregunta 37: ¿Qué frase está escrita correctamente? a) ¡Ah, qué susto me has dado! (R) b) ¡Ha, qué susto me has dado! c) ¡A, qué susto me has dado! d) ¡Ah, que susto me has dado! Explicación: '¡Ah!' es una interjección de sorpresa.
Pregunta 38: Selecciona la opción correcta. a) Hay que ser pacientes en estos momentos. (R) b) Ay que ser pacientes en estos momentos. c) Ahí que ser pacientes en estos momentos. d) Hay que ser pasientes en estos momentos. Explicación: 'Hay que' expresa obligación impersonal.
Pregunta 39: ¿Cuál de las siguientes oraciones es correcta? a) La fruta silvestre es una vaya comestible. b) La fruta silvestre es una baya comestible. (R) c) La fruta silvestre es una valla comestible. d) La fruta silvestre es una valla comenstible. Explicación: 'Baya' es un tipo de fruto.
Pregunta 40: Elige la frase correctamente escrita. a) No es cuestión de cantidad, si no de calidad. b) No es cuestión de cantidad, sino de calidad. (R) c) No es cuestión de cantidad, sinó de calidad. d) No es cuestión de cantidad, sino de calida. Explicación: 'Sino' (junto) para contraponer ideas. 'Calidad' con 'd'.
Pregunta 41: Identifica la oración sin errores. a) ¡Ay!, ahí hay una araña enorme. (R) b) ¡Ahí!, ay hay una araña enorme. c) ¡Hay!, ay ahí una araña enorme. d) ¡Ay!, hay ahí una araña enorme. Explicación: Combinación correcta de interjección, adverbio de lugar y verbo 'haber'.
Pregunta 42: ¿Qué frase está escrita correctamente? a) El porqué de su retraso es desconocido. (R) b) El por que de su retraso es desconocido. c) El porque de su retraso es desconocido. d) El por qué de su retraso es desconocido. Explicación: 'Porqué' (con tilde y junto) es un sustantivo.
Pregunta 43: Selecciona la opción correcta. a) Mañana habrá luna llena. (R) b) Mañana abrá luna llena. c) Mañana habra luna llana. d) Mañana ha brá luna llena. Explicación: 'Habrá' es la forma del verbo 'haber' en futuro. 'Luna' y 'llena' se escriben sin tilde.
Pregunta 44: ¿Cuál de las siguientes oraciones es correcta? a) Él ha hecho un gran esfuerzo. (R) b) Él ha echo un gran esfuerzo. c) Él ha echo un gran esfuerso. d) Él ha hecho un gran esfuerso. Explicación: 'Hecho' es el participio de 'hacer'. 'Esfuerzo' con 'z'.
Pregunta 45: Elige la frase correctamente escrita. a) Siempre ha habido problemas con eso. (R) b) Siempre a habido problemas con eso. c) Siempre ha a habido problemas con eso. d) Siempre a a habido problemas con heso. Explicación: 'Ha habido' es la forma correcta del verbo 'haber' en presente perfecto. 'Eso' sin 'h'.
Pregunta 46: Identifica la oración sin errores. a) La reunión será hay en la sala de juntas. b) La reunión será ay en la sala de juntas. c) La reunión será ahí en la sala de juntas. (R) d) La reunión será ahí en la sala de jutas. Explicación: 'Ahí' es un adverbio de lugar. 'Juntas' con 'n'.
Pregunta 47: ¿Qué frase está escrita correctamente? a) No es su hermano, si no su primo. b) No es su hermano, sino su primo. (R) c) No es su hermano, sí no su primo. d) No es su hermano, sinó su primo. Explicación: 'Sino' (junto) para contraponer ideas.
Pregunta 48: Selecciona la opción correcta. a) El porqué de la vida es una cuestión filosófica. (R) b) El por que de la vida es una cuestión filosófica. c) El porque de la vida es una cuestión filosófica. d) El por qué de la vida es una cuestión filosófica. Explicación: 'Porqué' (con tilde y junto) es un sustantivo.
Pregunta 49: ¿Cuál de las siguientes oraciones es correcta? a) Él tuvo un ataque de risa. (R) b) Él tubo un ataque de risa. c) Él tubo un ataque de riza. d) Él tuvo un ataque de riza. Explicación: 'Tuvo' (verbo 'tener'). 'Risa' con 's'.
Pregunta 50: Elige la frase correctamente escrita. a) ¡Ay!, me duele la rodilla. (R) b) ¡Ahí!, me duele la rodilla. c) ¡Hay!, me duele la rodilla. d) ¡Ay!, me duele la rodia. Explicación: '¡Ay!' es una interjección que expresa dolor.
            `;

            // Variables globales para el estado del test
            const allQuestions = []; // Ahora es un array único para todas las preguntas
            let shuffledQuestions = [];
            let currentQuestionIndex = 0;
            let correctCount = 0; // Aciertos para el test actual
            let incorrectCount = 0; // Errores para el test actual
            let userAnswers = {}; // Stores user's selected answer for each question: { 'shuffledIndex': 'selectedOptionText' }

            // Elementos del DOM
            const questionCounterElem = document.getElementById('question-counter');
            const currentQuestionElem = document.getElementById('current-question');
            const optionsContainer = document.getElementById('options-container');
            const feedbackMessageElem = document.getElementById('feedback-message');
            const explanationMessageElem = document.getElementById('explanation-message');
            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const testArea = document.getElementById('test-area');
            const correctCountDisplay = document.getElementById('correct-count');
            const incorrectCountDisplay = document.getElementById('incorrect-count');
            const progressBarFill = document.getElementById('progress-bar-fill');
            const dynamicInfoMessage = document.getElementById('dynamic-info-message');
            const dynamicActionButtons = document.getElementById('dynamic-action-buttons');
            const overallSummaryInline = document.getElementById('overall-summary-inline');
            const overallCorrectDisplay = document.getElementById('overall-correct-display');
            const overallIncorrectDisplay = document.getElementById('overall-incorrect-display');
            const restartButton = document.getElementById('restart-button'); // Renombrado de restartAllButton

            // Eliminar la sección de selección de nivel del DOM si existe
            const levelSelectionElement = document.getElementById('level-selection');
            if (levelSelectionElement) {
                levelSelectionElement.remove();
            }

            /**
             * Baraja un array in situ usando el algoritmo Fisher-Yates (Knuth).
             * @param {Array} array El array a barajar.
             */
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]]; // Intercambiar elementos
                }
            }

            /**
             * Parsea el contenido bruto del documento en un array de objetos de preguntas.
             * @param {string} text El contenido de texto bruto del documento.
             */
            function parseQuestions(text) {
                const questionsArray = [];
                // Dividir el contenido por "Pregunta X:" para obtener bloques de preguntas individuales
                const questionBlocks = text.split(/Pregunta \d+:\s*/).filter(block => block.trim() !== '');

                questionBlocks.forEach(block => {
                    const lines = block.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                    if (lines.length === 0) return;

                    let questionText = '';
                    const options = [];
                    let correctAnswer = '';
                    let explanation = '';

                    // La primera parte de la línea contiene la pregunta y las opciones
                    let fullQuestionLine = lines[0];

                    // Extraer el texto de la pregunta (todo antes de 'a)')
                    const questionMatch = fullQuestionLine.match(/^(.*?)\s*a\)/);
                    if (questionMatch) {
                        questionText = questionMatch[1].trim();
                    }

                    // Extract options and the correct answer
                    // This regex will capture each option including its letter and the text,
                    // stopping before the next option letter or the "Explicación:" part.
                    // Modified to handle the (R) marker and trailing periods more robustly.
                    const optionRegex = /(a|b|c|d)\)\s*(.*?)(?=\s*(?:a|b|c|d)\)|\s*Explicación:|$)/g;
                    let match;
                    const rawOptions = [];
                    while ((match = optionRegex.exec(fullQuestionLine)) !== null) {
                        rawOptions.push({ letter: match[1], text: match[2].trim() });
                    }

                    rawOptions.forEach(rawOption => {
                        let cleanOptionText = rawOption.text;

                        // Check for (R) and remove it, also set correctAnswer
                        if (cleanOptionText.includes('(R)')) {
                            cleanOptionText = cleanOptionText.replace(/\s*\(R\)\s*/, '').trim();
                            correctAnswer = cleanOptionText;
                        }

                        // Remove trailing period if present
                        if (cleanOptionText.endsWith('.')) {
                            cleanOptionText = cleanOptionText.slice(0, -1);
                        }

                        options.push(cleanOptionText);
                    });

                    // Extraer la explicación (comienza después de "Explicación:")
                    const explanationMatch = block.match(/Explicación:\s*(.*)/s); // /s para que coincida en múltiples líneas
                    if (explanationMatch) {
                        explanation = explanationMatch[1].trim();
                    }

                    // Asegurarse de que todos los campos necesarios estén presentes antes de añadir la pregunta
                    if (questionText && options.length === 4 && correctAnswer && explanation) {
                        questionsArray.push({
                            question: questionText,
                            options: options,
                            correctAnswer: correctAnswer,
                            explanation: explanation
                        });
                    }
                });
                return questionsArray;
            }

            // Llenar el array allQuestions con las preguntas parseadas
            allQuestions.push(...parseQuestions(docContent));

            /**
             * Muestra un mensaje en la página con botones dinámicos.
             * @param {string} message El mensaje a mostrar.
             * @param {Array<Object>} buttons Array de configuraciones de botones { text: string, action: function }.
             */
            function showDynamicMessage(message, buttons = []) {
                dynamicInfoMessage.textContent = message;
                dynamicActionButtons.innerHTML = ''; // Limpiar botones anteriores

                buttons.forEach(btnConfig => {
                    const button = document.createElement('button');
                    button.textContent = btnConfig.text;
                    button.classList.add('navigation-button');
                    button.onclick = btnConfig.action; // Asignar directamente la acción
                    dynamicActionButtons.appendChild(button);
                });
            }

            /**
             * Borra cualquier mensaje y botón dinámico.
             */
            function clearDynamicMessage() {
                dynamicInfoMessage.textContent = '';
                dynamicActionButtons.innerHTML = '';
            }

            /**
             * Muestra los resultados generales del test en línea.
             */
            function displayOverallResultsInline() {
                overallSummaryInline.classList.remove('hidden');
                overallCorrectDisplay.textContent = correctCount; // Ahora correctCount es el total
                overallIncorrectDisplay.textContent = incorrectCount; // Ahora incorrectCount es el total
            }

            /**
             * Actualiza la puntuación y la visualización de la barra de progreso.
             */
            function updateScoreAndProgress() {
                correctCountDisplay.textContent = correctCount;
                incorrectCountDisplay.textContent = incorrectCount;

                const totalQuestions = shuffledQuestions.length;
                const answeredQuestions = Object.keys(userAnswers).filter(key => userAnswers[key + '_checked']).length;

                if (totalQuestions > 0) {
                    const progressPercentage = (answeredQuestions / totalQuestions) * 100;
                    progressBarFill.style.width = `${progressPercentage}%`;
                } else {
                    progressBarFill.style.width = '0%';
                }

                // Actualizar la visualización de los totales generales (que ahora son los mismos que los del nivel)
                overallCorrectDisplay.textContent = correctCount;
                overallIncorrectDisplay.textContent = incorrectCount;

                // Habilitar/Deshabilitar el botón de reinicio según el progreso general
                if (correctCount > 0 || incorrectCount > 0) {
                    restartButton.classList.remove('disabled');
                } else {
                    restartButton.classList.add('disabled');
                }
            }

            /**
             * Carga y muestra la pregunta actual.
             */
            function loadQuestion() {
                clearDynamicMessage(); // Limpiar cualquier mensaje dinámico existente
                overallSummaryInline.classList.add('hidden'); // Ocultar resumen general en línea
                restartButton.classList.add('disabled'); // Asegurarse de que el botón de reinicio esté deshabilitado al cargar una nueva pregunta

                const questions = shuffledQuestions;
                if (questions.length === 0) {
                    currentQuestionElem.textContent = "No hay preguntas disponibles.";
                    optionsContainer.innerHTML = '';
                    prevButton.disabled = true;
                    nextButton.disabled = true;
                    feedbackMessageElem.innerHTML = ''; // Limpiar feedback e icono
                    explanationMessageElem.textContent = ''; // Limpiar explicación
                    updateScoreAndProgress();
                    return;
                }

                const questionData = questions[currentQuestionIndex];
                questionCounterElem.textContent = `Pregunta ${currentQuestionIndex + 1} de ${questions.length}`;
                currentQuestionElem.textContent = questionData.question;
                optionsContainer.innerHTML = '';
                feedbackMessageElem.innerHTML = ''; // Limpiar feedback e icono
                explanationMessageElem.textContent = '';

                // Crear botones de opción
                questionData.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.classList.add('option-button');
                    button.dataset.option = option;
                    button.onclick = () => selectOption(option);
                    optionsContainer.appendChild(button);
                });

                // Restaurar selección anterior si existe para la pregunta barajada actual
                const userAnswer = userAnswers[currentQuestionIndex];
                if (userAnswer) {
                    const selectedButton = optionsContainer.querySelector(`[data-option="${userAnswer}"]`);
                    if (selectedButton) {
                        selectedButton.classList.add('selected');
                    }
                    // Si ya se ha comprobado, volver a aplicar el feedback y la explicación
                    if (userAnswers[`${currentQuestionIndex}_checked`]) {
                        checkAnswer(userAnswer, true); // Volver a aplicar el feedback sin volver a contar
                        // Deshabilitar botones si ya se ha respondido
                        optionsContainer.querySelectorAll('.option-button').forEach(btn => btn.disabled = true);
                    }
                }

                updateNavigationButtons();
                updateScoreAndProgress();
                
                // Configurar el texto y la acción del botón "Siguiente"
                if (currentQuestionIndex === shuffledQuestions.length - 1) {
                    nextButton.textContent = "Finalizar Test";
                } else {
                    nextButton.textContent = "Siguiente";
                }
                nextButton.disabled = false; // Asegurarse de que el botón Siguiente/Finalizar esté habilitado
                nextButton.onclick = handleNextButtonClick;
            }

            /**
             * Maneja la selección de una opción por parte del usuario.
             * @param {string} selectedOption La opción de texto seleccionada.
             */
            function selectOption(selectedOption) {
                // Limpiar cualquier mensaje dinámico primero
                clearDynamicMessage();

                // Deshabilitar todas las opciones una vez que se selecciona una
                optionsContainer.querySelectorAll('.option-button').forEach(button => {
                    button.disabled = true;
                    button.classList.remove('selected', 'correct', 'incorrect');
                });

                const selectedButton = optionsContainer.querySelector(`[data-option="${selectedOption}"]`);
                if (selectedButton) {
                    selectedButton.classList.add('selected');
                }

                // Solo actualizar userAnswers y recuentos si esta pregunta no ha sido respondida antes
                if (!userAnswers[`${currentQuestionIndex}_checked`]) {
                    userAnswers[currentQuestionIndex] = selectedOption; // Almacenar respuesta por índice barajado
                    userAnswers[`${currentQuestionIndex}_checked`] = true; // Marcar pregunta como comprobada inmediatamente
                    checkAnswer(selectedOption, false); // Comprobar y contar
                } else {
                    // Si ya se ha respondido, solo volver a aplicar el feedback sin volver a contar
                    checkAnswer(selectedOption, true);
                }
            }

            /**
             * Comprueba la respuesta seleccionada por el usuario con la respuesta correcta.
             * @param {string} selectedOption La opción seleccionada por el usuario.
             * @param {boolean} isReload True si se llama durante una recarga de pregunta, false en caso contrario.
             */
            function checkAnswer(selectedOption, isReload = false) {
                const questionData = shuffledQuestions[currentQuestionIndex];
                const isCorrect = (selectedOption === questionData.correctAnswer);

                optionsContainer.querySelectorAll('.option-button').forEach(button => {
                    button.classList.remove('selected', 'correct', 'incorrect');
                    if (button.dataset.option === questionData.correctAnswer) {
                        button.classList.add('correct');
                    } else if (button.dataset.option === selectedOption) {
                        button.classList.add('incorrect');
                    }
                });

                // Actualizar recuentos solo si no se está recargando y no se ha contado ya esta pregunta
                if (!isReload) {
                    if (isCorrect) {
                        correctCount++;
                    } else {
                        incorrectCount++;
                    }
                }

                feedbackMessageElem.innerHTML = ''; // Limpiar feedback anterior

                const feedbackText = document.createElement('span');
                const feedbackIcon = document.createElement('i');
                feedbackIcon.classList.add('feedback-icon');

                if (isCorrect) {
                    feedbackText.textContent = "¡Correcto!";
                    feedbackText.classList.remove('text-red-600');
                    feedbackText.classList.add('text-green-600');
                    feedbackIcon.classList.add('fas', 'fa-check-circle', 'correct-icon');
                } else {
                    feedbackText.textContent = "Incorrecto.";
                    feedbackText.classList.remove('text-green-600');
                    feedbackText.classList.add('text-red-600');
                    feedbackIcon.classList.add('fas', 'fa-times-circle', 'incorrect-icon');
                }
                feedbackMessageElem.appendChild(feedbackText);
                feedbackMessageElem.appendChild(feedbackIcon);

                // Mostrar explicación
                explanationMessageElem.textContent = questionData.explanation;

                updateScoreAndProgress(); // Actualizar puntuación y barra de progreso después de comprobar

                // Comprobar si es la última pregunta del test Y acaba de ser respondida
                if (!isReload && currentQuestionIndex === shuffledQuestions.length - 1) {
                    handleTestCompletion();
                }
            }

            /**
             * Actualiza el estado deshabilitado de los botones de navegación.
             */
            function updateNavigationButtons() {
                prevButton.disabled = currentQuestionIndex === 0;
                // nextButton.disabled se maneja por la lógica de fin de test o por handleNextButtonClick
            }

            /**
             * Maneja la lógica cuando se completa el test.
             */
            function handleTestCompletion() {
                // Deshabilitar opciones y botón anterior ya que el test está completo
                optionsContainer.querySelectorAll('.option-button').forEach(btn => btn.disabled = true);
                prevButton.disabled = true;
                nextButton.disabled = true;
                nextButton.textContent = "Finalizar Test"; // Asegurarse de que el texto final esté visible

                showDynamicMessage(
                    `¡Enhorabuena! Has completado el test de ortografía. ¡Eres un/a campeón/a!`
                );
                displayOverallResultsInline();
                restartButton.classList.remove('disabled'); // Habilitar el botón de reinicio
            }

            // Función para el comportamiento predeterminado del botón siguiente (dentro del test)
            function handleNextButtonClick() {
                if (!userAnswers[`${currentQuestionIndex}_checked`]) {
                    showDynamicMessage("Por favor, selecciona una opción antes de continuar.");
                    return;
                }

                if (currentQuestionIndex < shuffledQuestions.length - 1) {
                    clearDynamicMessage();
                    currentQuestionIndex++;
                    loadQuestion();
                } else {
                    // Si es la última pregunta y ya se respondió, finalizar el test
                    handleTestCompletion();
                }
            }

            /**
             * Reinicia todo el progreso del test.
             */
            function restartTest() {
                currentQuestionIndex = 0;
                correctCount = 0;
                incorrectCount = 0;
                userAnswers = {}; // Borrar todas las respuestas

                // Barajar todas las preguntas de nuevo
                shuffledQuestions = [...allQuestions];
                shuffleArray(shuffledQuestions);

                // Asegurarse de que los elementos del test estén visibles y los resultados generales estén ocultos
                testArea.classList.remove('hidden');
                overallSummaryInline.classList.add('hidden'); // Ocultar resumen general en línea
                restartButton.classList.add('disabled'); // Deshabilitarlo al reiniciar

                // Restablecer el botón siguiente a su estado predeterminado
                nextButton.textContent = "Siguiente";
                nextButton.onclick = handleNextButtonClick;
                nextButton.disabled = false; // Volver a habilitar

                loadQuestion(); // Esto también borrará los mensajes dinámicos y hará visibles los elementos del test
            }

            // Event Listeners para la navegación
            prevButton.addEventListener('click', () => {
                clearDynamicMessage(); // Limpiar cualquier mensaje dinámico al navegar
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    loadQuestion();
                }
            });

            // Configuración inicial para el botón siguiente
            nextButton.addEventListener('click', handleNextButtonClick); // Adjuntar el manejador predeterminado

            // Event Listener para el botón de reinicio
            restartButton.addEventListener('click', restartTest);

            // Carga inicial del test cuando la ventana se carga
            window.onload = restartTest; // Iniciar el test directamente al cargar
        })(); // IIFE termina aquí
    </script>
</body>
</html>
